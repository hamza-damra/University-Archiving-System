<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Large File Handling Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .fade-in {
            animation: fadeIn 0.2s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h1 class="text-2xl font-bold mb-4">Large File Handling Demo</h1>
            <p class="text-gray-600 mb-4">
                This demo shows how the file preview system handles large files (> 5MB).
            </p>
            
            <div class="space-y-4">
                <div>
                    <h2 class="text-lg font-semibold mb-2">Test Scenarios:</h2>
                    <div class="space-y-2">
                        <button onclick="testSmallFile()" class="w-full px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                            Test Small File (1 MB) - Should preview normally
                        </button>
                        <button onclick="testExactThreshold()" class="w-full px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                            Test Exact Threshold (5 MB) - Should preview normally
                        </button>
                        <button onclick="testLargeFile()" class="w-full px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700">
                            Test Large File (10 MB) - Should show warning
                        </button>
                        <button onclick="testVeryLargeFile()" class="w-full px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">
                            Test Very Large File (50 MB) - Should show warning
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="result" class="bg-white rounded-lg shadow-lg p-6 hidden">
            <h2 class="text-xl font-bold mb-4">Result:</h2>
            <div id="resultContent"></div>
        </div>
    </div>

    <script type="module">
        import { FilePreviewModal } from './src/main/resources/static/js/file-preview-modal.js';

        // Mock FilePreviewModal for demo
        class DemoFilePreviewModal {
            constructor() {
                this.isOpen = false;
                this.modalElement = null;
            }

            createModal() {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 z-50 flex items-center justify-center p-4 fade-in';
                modal.innerHTML = `
                    <div class="absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm" onclick="window.demoModal.close()"></div>
                    <div class="relative bg-white dark:bg-gray-800 rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col">
                        <div class="flex items-center justify-between p-4 border-b border-gray-200">
                            <h2 class="text-lg font-semibold text-gray-900">File Preview</h2>
                            <button onclick="window.demoModal.close()" class="p-2 text-gray-600 hover:text-red-600">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="preview-content flex-1 overflow-auto p-6 bg-gray-50"></div>
                    </div>
                `;
                document.body.appendChild(modal);
                this.modalElement = modal;
            }

            async open(fileId, fileName, fileType, fileSize) {
                this.isOpen = true;
                this.createModal();

                const contentArea = this.modalElement.querySelector('.preview-content');
                
                // Check file size (5MB threshold)
                const MAX_FILE_SIZE = 5 * 1024 * 1024;
                if (fileSize > MAX_FILE_SIZE) {
                    this.showLargeFileWarning(fileSize, contentArea);
                } else {
                    contentArea.innerHTML = `
                        <div class="text-center py-12">
                            <svg class="w-16 h-16 text-green-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <p class="text-lg font-medium text-gray-900 mb-2">File Size OK</p>
                            <p class="text-sm text-gray-600">
                                File size: ${this.formatFileSize(fileSize)}<br>
                                This file can be previewed normally.
                            </p>
                        </div>
                    `;
                }
            }

            showLargeFileWarning(fileSize, contentArea) {
                const formattedSize = this.formatFileSize(fileSize);
                contentArea.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full py-12">
                        <svg class="w-16 h-16 text-yellow-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                        <p class="text-lg font-medium text-gray-900 mb-2">Large File Warning</p>
                        <p class="text-sm text-gray-600 mb-2 text-center max-w-md">
                            This file is <strong>${formattedSize}</strong>, which exceeds the recommended preview size of 5MB.
                        </p>
                        <p class="text-sm text-gray-600 mb-6 text-center max-w-md">
                            Loading large files may take longer and could affect browser performance.
                        </p>
                        <div class="flex flex-col sm:flex-row gap-3">
                            <button onclick="window.demoModal.loadPartialPreview()" 
                                    class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                <svg class="w-4 h-4 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                          d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                          d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                                Preview First Part
                            </button>
                            <button onclick="window.demoModal.downloadFile()" 
                                    class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                <svg class="w-4 h-4 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                          d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                </svg>
                                Download File
                            </button>
                        </div>
                    </div>
                `;
            }

            loadPartialPreview() {
                const contentArea = this.modalElement.querySelector('.preview-content');
                contentArea.innerHTML = `
                    <div class="text-center py-12">
                        <svg class="w-16 h-16 text-blue-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <p class="text-lg font-medium text-gray-900 mb-2">Partial Preview Loaded</p>
                        <p class="text-sm text-gray-600">
                            Showing first 500 lines of the file.<br>
                            Download the file to view complete content.
                        </p>
                    </div>
                `;
            }

            downloadFile() {
                const contentArea = this.modalElement.querySelector('.preview-content');
                contentArea.innerHTML = `
                    <div class="text-center py-12">
                        <svg class="w-16 h-16 text-green-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <p class="text-lg font-medium text-gray-900 mb-2">Download Started</p>
                        <p class="text-sm text-gray-600">
                            File download has been initiated.
                        </p>
                    </div>
                `;
            }

            close() {
                if (this.modalElement) {
                    this.modalElement.remove();
                    this.modalElement = null;
                }
                this.isOpen = false;
            }

            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + ' ' + sizes[i];
            }
        }

        window.demoModal = new DemoFilePreviewModal();

        window.testSmallFile = () => {
            window.demoModal.open(1, 'small-file.txt', 'text/plain', 1 * 1024 * 1024);
        };

        window.testExactThreshold = () => {
            window.demoModal.open(2, 'threshold-file.txt', 'text/plain', 5 * 1024 * 1024);
        };

        window.testLargeFile = () => {
            window.demoModal.open(3, 'large-file.txt', 'text/plain', 10 * 1024 * 1024);
        };

        window.testVeryLargeFile = () => {
            window.demoModal.open(4, 'very-large-file.txt', 'text/plain', 50 * 1024 * 1024);
        };
    </script>
</body>
</html>
