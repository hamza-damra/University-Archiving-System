<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading Indicators and Error Handling Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .test-result {
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 0.5rem;
            border: 2px solid;
        }
        .test-pass {
            background-color: #d1fae5;
            border-color: #10b981;
            color: #065f46;
        }
        .test-fail {
            background-color: #fee2e2;
            border-color: #ef4444;
            color: #991b1b;
        }
        .test-pending {
            background-color: #fef3c7;
            border-color: #f59e0b;
            color: #92400e;
        }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6 text-gray-900">Loading Indicators and Error Handling Test</h1>
        <p class="text-gray-600 mb-8">Task 8: Test loading indicators and error handling</p>

        <!-- Test Controls -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Test Controls</h2>
            <div class="space-y-4">
                <button id="testLoadingIndicator" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                    8.1: Test Loading Indicator Display
                </button>
                <button id="testLoadingRemoval" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                    8.2: Test Loading Indicator Removal
                </button>
                <button id="testErrorHandling" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                    8.3: Test Error Handling
                </button>
                <button id="testEmptyState" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                    8.4: Test Empty State
                </button>
                <button id="runAllTests" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 font-semibold">
                    Run All Tests
                </button>
            </div>
        </div>

        <!-- Test Results -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold mb-4">Test Results</h2>
            <div id="testResults" class="space-y-2">
                <p class="text-gray-500">No tests run yet. Click a test button to begin.</p>
            </div>
        </div>

        <!-- Mock File Explorer Container -->
        <div class="bg-white rounded-lg shadow-md p-6 mt-6">
            <h2 class="text-xl font-semibold mb-4">Mock File Explorer</h2>
            <div id="mockFileExplorerContainer" class="border-2 border-gray-300 rounded p-4 min-h-[200px]">
                <p class="text-gray-500">File Explorer will be rendered here during tests</p>
            </div>
        </div>
    </div>

    <script type="module">
        // Test results tracking
        const testResults = [];

        function addTestResult(testName, passed, message, details = null) {
            const result = { testName, passed, message, details, timestamp: new Date() };
            testResults.push(result);
            displayTestResults();
        }

        function displayTestResults() {
            const container = document.getElementById('testResults');
            if (testResults.length === 0) {
                container.innerHTML = '<p class="text-gray-500">No tests run yet.</p>';
                return;
            }

            container.innerHTML = testResults.map(result => {
                const statusClass = result.passed ? 'test-pass' : 'test-fail';
                const statusIcon = result.passed ? '✓' : '✗';
                const detailsHtml = result.details ? 
                    `<div class="mt-2 text-sm"><strong>Details:</strong> ${JSON.stringify(result.details, null, 2)}</div>` : '';
                
                return `
                    <div class="${statusClass} test-result">
                        <div class="font-semibold">${statusIcon} ${result.testName}</div>
                        <div class="mt-1">${result.message}</div>
                        ${detailsHtml}
                    </div>
                `;
            }).join('');
        }

        // Mock FileExplorerPage class for testing
        class MockFileExplorerPage {
            constructor() {
                this.container = document.getElementById('mockFileExplorerContainer');
            }

            showLoading(show) {
                if (show) {
                    this.container.style.opacity = '0.5';
                    this.container.style.pointerEvents = 'none';
                    this.container.innerHTML = '<div class="text-center py-8"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div><p class="mt-4 text-gray-600">Loading...</p></div>';
                } else {
                    this.container.style.opacity = '1';
                    this.container.style.pointerEvents = 'auto';
                }
            }

            renderContent() {
                this.container.innerHTML = `
                    <div class="space-y-4">
                        <div class="bg-blue-50 border border-blue-200 rounded p-4">
                            <h3 class="font-semibold">Folder 1</h3>
                        </div>
                        <div class="bg-blue-50 border border-blue-200 rounded p-4">
                            <h3 class="font-semibold">Folder 2</h3>
                        </div>
                    </div>
                `;
            }

            renderError(message) {
                this.container.innerHTML = `
                    <div class="bg-red-50 border border-red-200 rounded p-4 text-center">
                        <svg class="w-12 h-12 text-red-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <p class="text-red-700 font-semibold">${message}</p>
                    </div>
                `;
            }

            renderEmptyState() {
                this.container.innerHTML = `
                    <div class="bg-gray-50 border border-gray-200 rounded p-4 text-center">
                        <svg class="w-12 h-12 text-gray-300 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path>
                        </svg>
                        <p class="text-gray-500">Please select Academic Year and Semester to view files</p>
                    </div>
                `;
            }
        }

        const mockPage = new MockFileExplorerPage();

        // Test 8.1: Loading indicator display
        async function test81_LoadingIndicatorDisplay() {
            console.log('Running Test 8.1: Loading Indicator Display');
            
            // Trigger loading state
            mockPage.showLoading(true);
            
            // Wait a moment for DOM to update
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // Check if loading indicator is displayed
            const container = document.getElementById('mockFileExplorerContainer');
            const hasLoadingIndicator = container.innerHTML.includes('Loading') || 
                                       container.innerHTML.includes('animate-spin');
            const isDisabled = container.style.pointerEvents === 'none';
            const hasReducedOpacity = parseFloat(container.style.opacity) < 1;
            
            if (hasLoadingIndicator && isDisabled && hasReducedOpacity) {
                addTestResult(
                    '8.1 Loading Indicator Display',
                    true,
                    'Loading indicator is displayed correctly with disabled interactions',
                    { opacity: container.style.opacity, pointerEvents: container.style.pointerEvents }
                );
            } else {
                addTestResult(
                    '8.1 Loading Indicator Display',
                    false,
                    'Loading indicator not displayed correctly',
                    { 
                        hasLoadingIndicator, 
                        isDisabled, 
                        hasReducedOpacity,
                        opacity: container.style.opacity,
                        pointerEvents: container.style.pointerEvents
                    }
                );
            }
        }

        // Test 8.2: Loading indicator removal on success
        async function test82_LoadingIndicatorRemoval() {
            console.log('Running Test 8.2: Loading Indicator Removal');
            
            // First show loading
            mockPage.showLoading(true);
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // Then simulate successful load
            mockPage.showLoading(false);
            mockPage.renderContent();
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // Check if loading indicator is removed
            const container = document.getElementById('mockFileExplorerContainer');
            const hasLoadingIndicator = container.innerHTML.includes('Loading') || 
                                       container.innerHTML.includes('animate-spin');
            const isEnabled = container.style.pointerEvents === 'auto';
            const hasFullOpacity = parseFloat(container.style.opacity) === 1;
            const hasContent = container.innerHTML.includes('Folder');
            
            if (!hasLoadingIndicator && isEnabled && hasFullOpacity && hasContent) {
                addTestResult(
                    '8.2 Loading Indicator Removal',
                    true,
                    'Loading indicator removed and interactions enabled after successful load',
                    { opacity: container.style.opacity, pointerEvents: container.style.pointerEvents }
                );
            } else {
                addTestResult(
                    '8.2 Loading Indicator Removal',
                    false,
                    'Loading indicator not properly removed',
                    { 
                        hasLoadingIndicator, 
                        isEnabled, 
                        hasFullOpacity,
                        hasContent,
                        opacity: container.style.opacity,
                        pointerEvents: container.style.pointerEvents
                    }
                );
            }
        }

        // Test 8.3: Error handling during filter change
        async function test83_ErrorHandling() {
            console.log('Running Test 8.3: Error Handling');
            
            // Show loading
            mockPage.showLoading(true);
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // Simulate error
            mockPage.showLoading(false);
            mockPage.renderError('Failed to load file explorer');
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // Check if error is displayed and loading is removed
            const container = document.getElementById('mockFileExplorerContainer');
            const hasLoadingIndicator = container.innerHTML.includes('Loading') || 
                                       container.innerHTML.includes('animate-spin');
            const hasErrorMessage = container.innerHTML.includes('Failed to load');
            const isEnabled = container.style.pointerEvents === 'auto';
            const hasFullOpacity = parseFloat(container.style.opacity) === 1;
            
            if (!hasLoadingIndicator && hasErrorMessage && isEnabled && hasFullOpacity) {
                addTestResult(
                    '8.3 Error Handling',
                    true,
                    'Error message displayed and loading indicator removed',
                    { opacity: container.style.opacity, pointerEvents: container.style.pointerEvents }
                );
            } else {
                addTestResult(
                    '8.3 Error Handling',
                    false,
                    'Error handling not working correctly',
                    { 
                        hasLoadingIndicator, 
                        hasErrorMessage, 
                        isEnabled, 
                        hasFullOpacity,
                        opacity: container.style.opacity,
                        pointerEvents: container.style.pointerEvents
                    }
                );
            }
        }

        // Test 8.4: Empty state when no filters selected
        async function test84_EmptyState() {
            console.log('Running Test 8.4: Empty State');
            
            // Render empty state
            mockPage.renderEmptyState();
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // Check if empty state is displayed
            const container = document.getElementById('mockFileExplorerContainer');
            const hasEmptyMessage = container.innerHTML.includes('Please select') || 
                                   container.innerHTML.includes('Academic Year');
            const hasIcon = container.innerHTML.includes('svg');
            
            if (hasEmptyMessage && hasIcon) {
                addTestResult(
                    '8.4 Empty State',
                    true,
                    'Empty state displayed correctly when no filters selected'
                );
            } else {
                addTestResult(
                    '8.4 Empty State',
                    false,
                    'Empty state not displayed correctly',
                    { hasEmptyMessage, hasIcon }
                );
            }
        }

        // Run all tests
        async function runAllTests() {
            testResults.length = 0; // Clear previous results
            displayTestResults();
            
            await test81_LoadingIndicatorDisplay();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await test82_LoadingIndicatorRemoval();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await test83_ErrorHandling();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await test84_EmptyState();
            
            console.log('All tests completed');
        }

        // Event listeners
        document.getElementById('testLoadingIndicator').addEventListener('click', test81_LoadingIndicatorDisplay);
        document.getElementById('testLoadingRemoval').addEventListener('click', test82_LoadingIndicatorRemoval);
        document.getElementById('testErrorHandling').addEventListener('click', test83_ErrorHandling);
        document.getElementById('testEmptyState').addEventListener('click', test84_EmptyState);
        document.getElementById('runAllTests').addEventListener('click', runAllTests);
    </script>
</body>
</html>
