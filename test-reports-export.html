<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Reports & Export Functionality</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- External Libraries for Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.0/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-7xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-900 mb-8">Reports & Export Functionality Test</h1>
        
        <!-- Reports Dashboard Test -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Interactive Reports Dashboard</h2>
            <div id="reports-dashboard-container"></div>
        </div>
        
        <!-- Table Export Test -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Table Export Test</h2>
            
            <div id="test-table-container">
                <table id="test-table" class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Department</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Progress</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <tr>
                            <td class="px-6 py-4">Dr. Ahmed Hassan</td>
                            <td class="px-6 py-4">Computer Science</td>
                            <td class="px-6 py-4"><span class="badge bg-green-100 text-green-800 px-2 py-1 rounded">Active</span></td>
                            <td class="px-6 py-4">
                                <div class="w-full bg-gray-200 rounded-full h-6 relative">
                                    <div class="bg-green-500 h-6 rounded-full" style="width: 85%"></div>
                                    <span class="progress-bar-text absolute inset-0 flex items-center justify-center text-xs font-semibold">85%</span>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4">Dr. Sarah Ali</td>
                            <td class="px-6 py-4">Mathematics</td>
                            <td class="px-6 py-4"><span class="badge bg-green-100 text-green-800 px-2 py-1 rounded">Active</span></td>
                            <td class="px-6 py-4">
                                <div class="w-full bg-gray-200 rounded-full h-6 relative">
                                    <div class="bg-yellow-500 h-6 rounded-full" style="width: 65%"></div>
                                    <span class="progress-bar-text absolute inset-0 flex items-center justify-center text-xs font-semibold">65%</span>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4">Dr. Mohammed Khalil</td>
                            <td class="px-6 py-4">Physics</td>
                            <td class="px-6 py-4"><span class="badge bg-yellow-100 text-yellow-800 px-2 py-1 rounded">Pending</span></td>
                            <td class="px-6 py-4">
                                <div class="w-full bg-gray-200 rounded-full h-6 relative">
                                    <div class="bg-red-500 h-6 rounded-full" style="width: 35%"></div>
                                    <span class="progress-bar-text absolute inset-0 flex items-center justify-center text-xs font-semibold">35%</span>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Load modules -->
    <script src="src/main/resources/static/js/deanship-export.js"></script>
    <script src="src/main/resources/static/js/deanship-reports.js"></script>
    <script src="src/main/resources/static/js/deanship-tables.js"></script>
    
    <script>
        // Mock toast function
        window.showToast = function(message, type, duration) {
            console.log(`[${type.toUpperCase()}] ${message}`);
            alert(`${type.toUpperCase()}: ${message}`);
        };
        
        // Mock DashboardState
        window.DashboardState = {
            getCurrentSemester: () => ({ id: 1, name: 'First Semester 2024-2025' }),
            getCurrentUser: () => ({ name: 'Test Dean' })
        };
        
        // Mock EmptyState
        window.EmptyState = {
            render: (options) => {
                return `
                    <div class="text-center py-8">
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">${options.title}</h3>
                        <p class="text-gray-600">${options.message}</p>
                    </div>
                `;
            }
        };
        
        // Mock SkeletonLoader
        window.SkeletonLoader = {
            table: (rows, cols) => {
                return `
                    <tr>
                        <td colspan="${cols}" class="px-6 py-4 text-center text-gray-500">
                            Loading...
                        </td>
                    </tr>
                `;
            }
        };
        
        // Mock API - Override fetch for testing
        const originalFetch = window.fetch;
        window.fetch = function(url, options) {
            console.log('Mock API call:', url);
            
            // Mock department report data
            if (url.includes('/deanship/reports/by-department')) {
                return Promise.resolve({
                    ok: true,
                    json: () => Promise.resolve([
                        {
                            departmentName: 'Computer Science',
                            totalCourses: 25,
                            totalProfessors: 15,
                            uploadedDocuments: 120,
                            pendingDocuments: 30,
                            overdueDocuments: 5,
                            compliancePercentage: 85.5
                        },
                        {
                            departmentName: 'Mathematics',
                            totalCourses: 20,
                            totalProfessors: 12,
                            uploadedDocuments: 95,
                            pendingDocuments: 25,
                            overdueDocuments: 8,
                            compliancePercentage: 72.3
                        },
                        {
                            departmentName: 'Physics',
                            totalCourses: 18,
                            totalProfessors: 10,
                            uploadedDocuments: 80,
                            pendingDocuments: 20,
                            overdueDocuments: 3,
                            compliancePercentage: 78.9
                        }
                    ])
                });
            }
            
            // Mock level report data
            if (url.includes('/deanship/reports/by-level')) {
                return Promise.resolve({
                    ok: true,
                    json: () => Promise.resolve([
                        {
                            courseLevel: 'Undergraduate',
                            totalCourses: 45,
                            uploadedDocuments: 200,
                            pendingDocuments: 50,
                            overdueDocuments: 10,
                            compliancePercentage: 80.0
                        },
                        {
                            courseLevel: 'Graduate',
                            totalCourses: 18,
                            uploadedDocuments: 95,
                            pendingDocuments: 25,
                            overdueDocuments: 6,
                            compliancePercentage: 75.4
                        }
                    ])
                });
            }
            
            // Mock semester report data
            if (url.includes('/deanship/reports/by-semester')) {
                return Promise.resolve({
                    ok: true,
                    json: () => Promise.resolve([
                        {
                            semesterName: 'First Semester',
                            academicYear: '2024-2025',
                            totalCourses: 63,
                            totalProfessors: 37,
                            uploadedDocuments: 295,
                            pendingDocuments: 75,
                            overdueDocuments: 16,
                            compliancePercentage: 78.7
                        },
                        {
                            semesterName: 'Second Semester',
                            academicYear: '2023-2024',
                            totalCourses: 58,
                            totalProfessors: 35,
                            uploadedDocuments: 280,
                            pendingDocuments: 60,
                            overdueDocuments: 12,
                            compliancePercentage: 82.4
                        }
                    ])
                });
            }
            
            return originalFetch(url, options);
        };
        
        // Initialize Reports Dashboard
        const reportsDashboard = new ReportsDashboard('reports-dashboard-container');
        reportsDashboard.init();
        
        // Add export buttons to test table
        TableExportHelper.addExportButtons('test-table-container', 'test-table', 'Test Table');
        
        console.log('Test page initialized successfully!');
        console.log('- Reports Dashboard loaded');
        console.log('- Export buttons added to test table');
        console.log('- Try switching views and exporting reports');
    </script>
</body>
</html>
